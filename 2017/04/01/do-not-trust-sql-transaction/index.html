<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">SQL íŠ¸ëœì­ì…˜ - ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤ | The Sapzil</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.sapzil.org/2017/04/01/do-not-trust-sql-transaction/"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="SQL íŠ¸ëœì­ì…˜ - ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤ | The Sapzil"><meta data-rh="true" name="description" content="RDBMSë¥¼ ì“°ëŠ” ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” íŠ¸ëœì­ì…˜ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ RDBMSì˜ íŠ¸ëœì­ì…˜ì„ ë„ˆë¬´ ë¯¿ë‹¤ê°€ëŠ” ê¹œì§ ë†€ë„ ì¼ì´ ë²Œì–´ì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤."><meta data-rh="true" property="og:description" content="RDBMSë¥¼ ì“°ëŠ” ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” íŠ¸ëœì­ì…˜ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ RDBMSì˜ íŠ¸ëœì­ì…˜ì„ ë„ˆë¬´ ë¯¿ë‹¤ê°€ëŠ” ê¹œì§ ë†€ë„ ì¼ì´ ë²Œì–´ì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2017-04-01T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="database"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.sapzil.org/2017/04/01/do-not-trust-sql-transaction/"><link data-rh="true" rel="alternate" href="https://blog.sapzil.org/2017/04/01/do-not-trust-sql-transaction/" hreflang="ko"><link data-rh="true" rel="alternate" href="https://blog.sapzil.org/2017/04/01/do-not-trust-sql-transaction/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="The Sapzil RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="The Sapzil Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KFBZE189TB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KFBZE189TB",{})</script>


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300,400,700|Inter:400,700&amp;display=swap" media="print" onload="this.media=&#39;all&#39;"><link rel="stylesheet" href="/assets/css/styles.65d75be0.css">
<link rel="preload" href="/assets/js/runtime~main.308aae1b.js" as="script">
<link rel="preload" href="/assets/js/main.8282d200.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">ğŸ‘· The Sapzil</b></a><a class="navbar__item navbar__link" href="/">Posts</a><a class="navbar__item navbar__link" href="/tags/">Tags</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="ìµœê·¼ ë¸”ë¡œê·¸ ë¬¸ì„œ ë‘˜ëŸ¬ë³´ê¸°"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/01/22/k3s/">ë‚˜ì˜ k3s êµ¬ì„± ë‘˜ëŸ¬ë³´ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/03/04/gradle-convention-plugins/">Gradle Convention Plugins ì‚½ì§ˆê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2021/05/09/nix/">â€˜ìˆœìˆ˜ í•¨ìˆ˜í˜•â€™ íŒ¨í‚¤ì§€ ê´€ë¦¬ì Nix ë§›ë³´ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2019/12/29/microservices-1/">ë‚˜ë„ MSA í•œë²ˆ í•´ë³´ì (1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2019/06/09/docker-desktop-for-windows-home/">Windows 10 Homeì— Docker Desktop ì„¤ì¹˜í•˜ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/08/26/kotlin-jpa-pitfalls-embeddable/">Kotlinì—ì„œ JPA ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•  ì  (2) - Embeddable, IdClass</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/06/20/gradle-subproject-grouping/">Gradleì—ì„œ ì„œë¸Œ í”„ë¡œì íŠ¸ë¥¼ í•œ ë””ë ‰í† ë¦¬ì— ëª°ì•„ë„£ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/01/21/taming-maven-transitive-dependencies/">Mavenì˜ Transitive Dependency ê¸¸ë“¤ì´ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2017/11/02/kotlin-jpa-pitfalls/">Kotlinì—ì„œ JPA ì‚¬ìš©í•  ë•Œ ì£¼ì˜í•  ì </a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2017/07/16/redux-observable/">redux-observable ì‚¬ìš©í•˜ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2017/07/10/diffmonster/">Diff Monsterë¥¼ ì†Œê°œí•©ë‹ˆë‹¤</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/2017/04/01/do-not-trust-sql-transaction/">SQL íŠ¸ëœì­ì…˜ - ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2017/03/12/testing-restful-api-servers/">RESTful API ì„œë²„ í…ŒìŠ¤íŠ¸í•˜ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2016/12/15/react-with-rx/">RxJSë¡œ React ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ê´€ë¦¬í•˜ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2016/08/04/jersey-hk2/">Jersey 2.xì— ë‚´ì¥ëœ ì˜ì¡´ì„± ì£¼ì… ê¸°ëŠ¥ ì‚¬ìš©í•˜ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2016/07/29/animeta-react-ssr/">ì• ë‹ˆë©”íƒ€ì˜ React ì„œë²„ ë Œë”ë§ ì•„í‚¤í…ì³</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2016/03/20/react-internals-utils/">React ì†ŒìŠ¤ ì½”ë“œ ì½ê¸° - ìœ í‹¸ë¦¬í‹°ë“¤</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2016/03/17/react-internals-elements/">React ì†ŒìŠ¤ ì½”ë“œ ì½ê¸° - ReactElement</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2016/03/09/react-internals-modules/">React ì†ŒìŠ¤ ì½”ë“œ ì½ê¸° - ëª¨ë“ˆ ì‹œìŠ¤í…œ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2015/10/24/advanced-uwsgi/">uWSGIì˜ ê³ ê¸‰ ê¸°ëŠ¥ë“¤</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2015/10/07/thinking-in-graphql/">Thinking in GraphQL (ë²ˆì—­)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2015/09/01/graphql-rfc/">GraphQL ì‚´í´ë³´ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2015/05/15/graphql-and-relay/">GraphQLê³¼ Relay: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì˜ ë¯¸ë˜</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2014/09/21/python-web-app-deploy/">íŒŒì´ì¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬: ê³ ë ¤í•  ì ë“¤</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2014/08/12/upstart/">Upstartë¡œ ì˜¤ë˜ ë„ëŠ” í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬í•˜ê¸°</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2014/08/10/jquery-to-react/">jQuery to React</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">SQL íŠ¸ëœì­ì…˜ - ë¯¿ëŠ” ë„ë¼ì— ë°œë“± ì°íŒë‹¤</h1><div class="container_mt6G margin-vert--md"><time datetime="2017-04-01T00:00:00.000Z" itemprop="datePublished">2017ë…„ 4ì›” 1ì¼</time> Â· <!-- -->ì•½ 6ë¶„</div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>RDBMSë¥¼ ì“°ëŠ” ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” íŠ¸ëœì­ì…˜ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ RDBMSì˜ íŠ¸ëœì­ì…˜ì„ ë„ˆë¬´ ë¯¿ë‹¤ê°€ëŠ” ê¹œì§ ë†€ë„ ì¼ì´ ë²Œì–´ì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><figure><img loading="lazy" src="/public/img/lsm.jpg" alt="êµ­ë¯¼ ì—¬ëŸ¬ë¶„ ì•ˆì‹¬í•˜ì‹­ì‹œì˜¤" class="img_ev3q"><figcaption>??? : <a href="https://librewiki.net/wiki/%EC%9D%B4%EC%8A%B9%EB%A7%8C" target="_blank" rel="noopener noreferrer">êµ­ë¯¼ ì—¬ëŸ¬ë¶„ ì•ˆì‹¬í•˜ì‹­ì‹œì˜¤</a></figcaption></figure><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ë¬¸ì œ">ë¬¸ì œ<a href="#ë¬¸ì œ" class="hash-link" aria-label="ë¬¸ì œì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="ë¬¸ì œì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h2><p>ë‹¤ìŒê³¼ ê°™ì´ ì–¼í• ë³´ë©´ ë¬´í•´í•´ ë³´ì´ëŠ” ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># CREATE TABLE account (id integer, money integer, state text);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># INSERT INTO account (id, money, state) VALUES (1, 10, &#x27;poor&#x27;);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> begin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;SELECT state FROM account WHERE id = 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;poor&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;UPDATE account SET state = &#x27;rich&#x27;, money = money * 1000 WHERE id = 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="í´ë¦½ë³´ë“œì— ì½”ë“œ ë³µì‚¬" title="ë³µì‚¬" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ì´ëŸ° ì½”ë“œê°€ ë™ì‹œì— ë‹¤ìŒ ìˆœì„œë¡œ ì‹¤í–‰ë˜ë©´ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§ˆê¹Œìš”?</p><table><thead><tr><th>íŠ¸ëœì­ì…˜ A</th><th>íŠ¸ëœì­ì…˜ B</th></tr></thead><tbody><tr><td>BEGIN</td><td></td></tr><tr><td>SELECT state FROM account WHERE id = 1</td><td></td></tr><tr><td></td><td>BEGIN</td></tr><tr><td></td><td>SELECT state FROM account WHERE id = 1</td></tr><tr><td></td><td>UPDATE account SET state = &#x27;rich&#x27;, money = money * 1000 WHERE id = 1</td></tr><tr><td></td><td>COMMIT</td></tr><tr><td>UPDATE account SET state = &#x27;rich&#x27;, money = money * 1000 WHERE id = 1</td><td></td></tr><tr><td>COMMIT</td><td></td></tr></tbody></table><p>moneyê°€ 10,000,000ì´ ë©ë‹ˆë‹¤.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ì™œì£ ">ì™œì£ ?<a href="#ì™œì£ " class="hash-link" aria-label="ì™œì£ ?ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="ì™œì£ ?ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h2><p>SQL í‘œì¤€ì—ì„œ isolation levelì€ READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE ë„¤ ê°€ì§€ì…ë‹ˆë‹¤.
SERIALIZABLEì´ ê°€ì¥ ë†’ì€ ê²©ë¦¬ìˆ˜ì¤€ì´ì§€ë§Œ ì„±ëŠ¥ ìƒì˜ ì´ìœ ë¡œ <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html" target="_blank" rel="noopener noreferrer">MySQL (InnoDB)ì€ REPEATABLE READ</a>, <a href="https://www.postgresql.org/docs/current/static/transaction-iso.html" target="_blank" rel="noopener noreferrer">PostgreSQLì€ READ COMMITTED</a>ê°€ ê¸°ë³¸ê°’ì…ë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ ê¸°ë³¸ isolation levelì—ì„œ <code>UPDATE</code> ì¿¼ë¦¬ëŠ” ëŒ€ìƒ ë ˆì½”ë“œë¥¼ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë¨¼ì € ì—…ë°ì´íŠ¸í•œ ë’¤ ì»¤ë°‹ëœ ê²½ìš° ì—…ë°ì´íŠ¸ ëœ ë°ì´í„°ë¥¼ ë³´ê²Œ ë©ë‹ˆë‹¤.</p><blockquote><p>... a target row might have already been updated (or deleted or locked) by another concurrent transaction by the time it is found. In this case, the would-be updater will wait for the first updating transaction to commit or roll back (if it is still in progress). ... If the first updater commits, the second updater ... <strong>will attempt to apply its operation to the updated version of the row.</strong> <a href="https://www.postgresql.org/docs/current/static/transaction-iso.html#XACT-READ-COMMITTED" target="_blank" rel="noopener noreferrer">(Postgres ë¬¸ì„œ)</a></p></blockquote><blockquote><p>The snapshot of the database state applies to SELECT statements within a transaction, not necessarily to DML statements. If you insert or modify some rows and then commit that transaction, a DELETE or UPDATE statement issued from another concurrent REPEATABLE READ transaction could affect those just-committed rows, even though the session could not query them. <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-consistent-read.html" target="_blank" rel="noopener noreferrer">(MySQL ë¬¸ì„œ)</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="í•´ê²°ì±…">í•´ê²°ì±…<a href="#í•´ê²°ì±…" class="hash-link" aria-label="í•´ê²°ì±…ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="í•´ê²°ì±…ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isolation-level-ë†’ì´ê¸°">Isolation level ë†’ì´ê¸°<a href="#isolation-level-ë†’ì´ê¸°" class="hash-link" aria-label="Isolation level ë†’ì´ê¸°ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="Isolation level ë†’ì´ê¸°ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h3><p>MySQLì—ì„œëŠ” SERIALIZABLE ë°–ì— ë‹µì´ ì—†ëŠ”ë° ì´ ê²½ìš°ì— í•­ìƒ ë½ì´ ê±¸ë¦¬ë¯€ë¡œ í˜„ì‹¤ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° í˜ë“­ë‹ˆë‹¤.</p><p>PostgresëŠ” REPEATABLE READë¡œ ì˜¬ë¦¬ë©´ ì´ëŸ¬í•œ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‹  íŠ¸ëœì­ì…˜ Aê°€ <code>UPDATE</code>ë¥¼ ì‹œë„í•  ë•Œ íŠ¸ëœì­ì…˜ì´ ì¤‘ë‹¨ë˜ì–´ ë²„ë¦¬ë¯€ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ì—ì„œ ì „ì²´ íŠ¸ëœì­ì…˜ì„ ì²˜ìŒë¶€í„° ì¬ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤.</p><blockquote><p>a target row might have already been updated (or deleted or locked) by another concurrent transaction by the time it is found. In this case, the repeatable read transaction will wait for the first updating transaction to commit or roll back (if it is still in progress). ... if the first updater commits (and actually updated or deleted the row, not just locked it) then the repeatable read transaction <strong>will be rolled back</strong> with the message <code>ERROR:  could not serialize access due to concurrent update</code> because a repeatable read transaction cannot modify or lock rows changed by other transactions after the repeatable read transaction began. <a href="https://www.postgresql.org/docs/current/static/transaction-iso.html#XACT-REPEATABLE-READ" target="_blank" rel="noopener noreferrer">(Postgres ë¬¸ì„œ)</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="select-for-update-ì‚¬ìš©"><code>SELECT FOR UPDATE</code> ì‚¬ìš©<a href="#select-for-update-ì‚¬ìš©" class="hash-link" aria-label="select-for-update-ì‚¬ìš©ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="select-for-update-ì‚¬ìš©ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h3><p>ì—…ë°ì´íŠ¸ í•  ë ˆì½”ë“œë¥¼ ê°€ì ¸ì˜¬ ë•Œ <code>SELECT</code> ì¿¼ë¦¬ ëŒ€ì‹  <code>SELECT FOR UPDATE</code> ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ë½ì´ ê±¸ë¦½ë‹ˆë‹¤.
ê·¸ëŸ¬ë©´ íŠ¸ëœì­ì…˜ Bê°€ ì½ê¸°ë¥¼ ì‹œë„í•  ë•Œ íŠ¸ëœì­ì…˜ Aê°€ ì»¤ë°‹ (ë˜ëŠ” ë¡¤ë°±)ë˜ê¸°ê¹Œì§€ ê¸°ë‹¤ë¦¬ê²Œ ë˜ë¯€ë¡œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-í•œë²ˆì—-ëª¨ë“ -ê²ƒì„-ì²˜ë¦¬"><code>UPDATE</code> í•œë²ˆì— ëª¨ë“  ê²ƒì„ ì²˜ë¦¬<a href="#update-í•œë²ˆì—-ëª¨ë“ -ê²ƒì„-ì²˜ë¦¬" class="hash-link" aria-label="update-í•œë²ˆì—-ëª¨ë“ -ê²ƒì„-ì²˜ë¦¬ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="update-í•œë²ˆì—-ëª¨ë“ -ê²ƒì„-ì²˜ë¦¬ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h3><p><code>SELECT</code>ë¥¼ í•˜ì§€ ë§ê³  <code>UPDATE account SET state = &#x27;rich&#x27;, money = money * 1000 WHERE id = 1 AND state = &#x27;poor&#x27;</code>ì™€ ê°™ì´ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ì´ë ‡ê²Œ í•˜ë©´ ë¡œì§ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ SQLë¡œ ì˜®ê²¨ê°€ê¸°ëŠ” í•˜ì§€ë§Œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì»¤ë°‹ëœ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ë™í•´ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ë‚™ê´€ì optimistic-ë½">ë‚™ê´€ì (optimistic) ë½<a href="#ë‚™ê´€ì optimistic-ë½" class="hash-link" aria-label="ë‚™ê´€ì (optimistic) ë½ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="ë‚™ê´€ì (optimistic) ë½ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h3><p>í…Œì´ë¸”ì— ë²„ì „ í•„ë“œë¥¼ ì¶”ê°€í•´ì„œ <code>SELECT</code>í•  ë•Œ ê°€ì ¸ì˜µë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>UPDATE</code>í•  ë•Œ WHERE ì ˆì— ê¸°ì¡´ ë²„ì „ì„ ì¶”ê°€í•˜ê³  +1ëœ ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¥¼ ì‹œë„í•©ë‹ˆë‹¤. ì—…ë°ì´íŠ¸ ëœ ë ˆì½”ë“œ ìˆ˜ë¥¼ ê²€ì‚¬í•´ì„œ 0ê°œë¼ë©´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë²„ì „ì´ ë³€ê²½ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ <strong>ì¶©ëŒ</strong>ì„ ê°ì§€í•œ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ì—ì„œ ì „ì²´ íŠ¸ëœì­ì…˜ì„ ì²˜ìŒë¶€í„° ì¬ì‹œë„í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://docs.jboss.org/hibernate/orm/4.0/devguide/en-US/html/ch05.html" target="_blank" rel="noopener noreferrer">ORMì—ì„œ ë‚™ê´€ì  ë½ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ê²°ë¡ ">ê²°ë¡ <a href="#ê²°ë¡ " class="hash-link" aria-label="ê²°ë¡ ì— ëŒ€í•œ ì§ì ‘ ë§í¬" title="ê²°ë¡ ì— ëŒ€í•œ ì§ì ‘ ë§í¬">â€‹</a></h2><p>ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì½ì€ ë‹¤ìŒ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì²˜ë¦¬ í›„ ë‹¤ì‹œ ì“°ëŠ” ê²½ìš°ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>íƒœê·¸:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/database/">database</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ íƒìƒ‰"><a class="pagination-nav__link pagination-nav__link--prev" href="/2017/07/10/diffmonster/"><div class="pagination-nav__sublabel">ì´ì „ ê²Œì‹œë¬¼</div><div class="pagination-nav__label">Diff Monsterë¥¼ ì†Œê°œí•©ë‹ˆë‹¤</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2017/03/12/testing-restful-api-servers/"><div class="pagination-nav__sublabel">ë‹¤ìŒ ê²Œì‹œë¬¼</div><div class="pagination-nav__label">RESTful API ì„œë²„ í…ŒìŠ¤íŠ¸í•˜ê¸°</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ë¬¸ì œ" class="table-of-contents__link toc-highlight">ë¬¸ì œ</a></li><li><a href="#ì™œì£ " class="table-of-contents__link toc-highlight">ì™œì£ ?</a></li><li><a href="#í•´ê²°ì±…" class="table-of-contents__link toc-highlight">í•´ê²°ì±…</a><ul><li><a href="#isolation-level-ë†’ì´ê¸°" class="table-of-contents__link toc-highlight">Isolation level ë†’ì´ê¸°</a></li><li><a href="#select-for-update-ì‚¬ìš©" class="table-of-contents__link toc-highlight"><code>SELECT FOR UPDATE</code> ì‚¬ìš©</a></li><li><a href="#update-í•œë²ˆì—-ëª¨ë“ -ê²ƒì„-ì²˜ë¦¬" class="table-of-contents__link toc-highlight"><code>UPDATE</code> í•œë²ˆì— ëª¨ë“  ê²ƒì„ ì²˜ë¦¬</a></li><li><a href="#ë‚™ê´€ì optimistic-ë½" class="table-of-contents__link toc-highlight">ë‚™ê´€ì (optimistic) ë½</a></li></ul></li><li><a href="#ê²°ë¡ " class="table-of-contents__link toc-highlight">ê²°ë¡ </a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2024. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.308aae1b.js"></script>
<script src="/assets/js/main.8282d200.js"></script>
</body>
</html>